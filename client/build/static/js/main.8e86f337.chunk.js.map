{"version":3,"sources":["api/fetchWrap.js","logic/webSocket.js","assets/img/avatar.png","api/chat.js","logic/chat.js","vars.js","components/Chat/Chat.jsx","store/webSocket.js","api/auth.js","logic/auth.js","components/Header/Header.jsx","components/Main/Main.jsx","api/user.js","logic/user.js","components/UsersList/UsersList.jsx","components/Auth/Auth.jsx","assets/audio/new_message.wav","components/Modal/Modal.jsx","components/App.jsx","store/index.js","store/auth.js","store/modal.js","store/RenderList.js","index.jsx"],"names":["getOptions","body","options","method","credentials","localStorage","getItem","headers","JSON","stringify","fetchWrap","url","a","fetch","global","serverLink","response","responseBody","clone","json","changeTokenA","setItem","WebSocketLogic","auth","socket","modal","setNewMessage","onmessage","event","msg","parse","data","action","err","setTimeout","send","username","id","senderId","recipientId","ChatApi","chatId","message","ChatLogic","create","get","sendMessage","fetchCount","Chat","history","useHistory","useSelector","state","push","webSocket","useParams","useState","chat","setChat","newMessage","input","setInput","messageArea","useRef","alredyScroled","socketChat","WebSocket","split","useEffect","getAll","users","forEach","user","index","splice","connect","current","newChat","messages","scrollTop","scrollHeight","className","ref","map","color","plase","src","avatar","alt","width","height","messageId","value","onChange","target","rows","placeholder","onClick","Date","now","Math","random","date","sendAction","role","defaultState","webSocketReducer","type","payload","AuthApi","removeItem","AuthLogic","dispatch","Error","loginOrRegister","token","Header","useDispatch","location","useLocation","pathname","logout","to","style","cursor","Main","UserApi","property","UserLogic","getProperty","UsersList","label","render","setRender","page","setPage","people","setPeople","searchInput","setSearchInput","allpage","setAllPage","sortedPeople","useMemo","length","filter","person","toLowerCase","includes","ceil","chatAction","inner","typeAction","friends","gotReq","sentReq","chats","Auth","errHandler","submit","preventDefault","FormData","Object","fromEntries","document","href","textContent","borderRadius","onSubmit","required","name","transition","htmlFor","Modal","modalBody","setModalBody","stateModalBody","stateRenderList","renderList","notification","Audio","sound","play","App","start","set","minHeight","exact","path","component","rootReducer","combineReducers","store","createStore","ReactDOM","querySelector"],"mappings":"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","file":"static/js/main.8e86f337.chunk.js","sourcesContent":["function getOptions(body) {\r\n  const options = {\r\n    method: \"POST\",\r\n    credentials: \"include\",\r\n  }\r\n  if (localStorage.getItem(\"token\")) {\r\n    options.headers = {\r\n      \"Authorization\": `Bearer ${localStorage.getItem(\"token\")}`,\r\n      \"Content-Type\": \"application/json;charset=utf-8\",\r\n    }\r\n  }else{\r\n    options.headers = {\r\n      \"Content-Type\": \"application/json;charset=utf-8\",\r\n    }\r\n  }\r\n  if(body){\r\n    options.body = JSON.stringify(body)\r\n  }\r\n  return options;\r\n}\r\n\r\nexport async function fetchWrap(url, body) {\r\n  const response = await fetch(`${global.serverLink}/${url}`, getOptions(body))\r\n  // клонирование запроса чтобы можно было прочитать тело второй раз, нужно чтобы обновить токен при его просрочке\r\n  let responseBody = response.clone()\r\n  responseBody = await responseBody.json()\r\n  if(responseBody.changeTokenA){\r\n    localStorage.setItem(\"token\", responseBody.changeTokenA)\r\n  }\r\n  return response\r\n}","export class WebSocketLogic{\r\n  static connect(auth, socket, modal, setNewMessage){\r\n    if(auth){\r\n      socket.onmessage = (event) => {\r\n        const msg = JSON.parse(event.data)\r\n        switch(msg.action){\r\n          case \"alert\": modal(msg.body)\r\n            break\r\n            // обяснение работы находиться в Chat.jsx\r\n          case \"message\": \r\n            try{\r\n              //Try catch чтобы react не ругался\r\n              setNewMessage(msg.body)\r\n            }catch(err){}\r\n            break\r\n          default: \r\n        }\r\n      }\r\n      setTimeout(() => {\r\n        socket.send(JSON.stringify({action: \"connect\", username: auth.username, id: auth.id}))\r\n      }, 1000)\r\n    }\r\n  }\r\n  static sendAction(action, senderId, recipientId, socket, body){\r\n    socket.send(JSON.stringify({action, senderId, recipientId, body}))\r\n  }\r\n}","export default __webpack_public_path__ + \"static/media/avatar.fbfe03c2.png\";","import { fetchWrap } from \"./fetchWrap\";\r\n\r\nexport class ChatApi{\r\n  static async create(recipientId){\r\n    let response = await fetchWrap(\"chat/create\", {recipientId})\r\n    response = await response.json()\r\n    return response\r\n  }\r\n  static async get(chatId){\r\n    let response = await fetchWrap(`chat/get/${chatId}`)\r\n    response = await response.json()\r\n    return response\r\n  }\r\n  static async sendMessage(chatId, message){\r\n    let response = await fetchWrap(\"chat/sendMessage\", {chatId, message})\r\n    response = await response.json()\r\n    return response\r\n  }\r\n}","import { ChatApi } from \"../api/chat\"\r\n\r\nexport class ChatLogic{\r\n  static async create(recipientId){\r\n    const response = await ChatApi.create(recipientId)\r\n    return response\r\n  }\r\n  static async get(chatId){\r\n    const response = await ChatApi.get(chatId)\r\n    return response\r\n  }\r\n  static async sendMessage(chatId, message){\r\n    const response = await ChatApi.sendMessage(chatId, message)\r\n    return response\r\n  }\r\n}","global.serverLink = \"http://localhost:5000\"\r\nglobal.fetchCount = 0","import React, { useState, useEffect, useRef } from \"react\"\r\nimport { useParams, useHistory } from \"react-router-dom\"\r\nimport {useSelector} from \"react-redux\"\r\nimport { ChatLogic } from \"../../logic/chat\"\r\nimport { WebSocketLogic } from \"../../logic/webSocket\"\r\n\r\nimport \"./Chat.sass\"\r\nimport avatar from \"../../assets/img/avatar.png\"\r\n\r\n\r\nexport default function Chat(){\r\n  const history = useHistory()\r\n  const auth = useSelector(state => state.auth)\r\n  if(!auth){\r\n    history.push(\"/\")\r\n  }\r\n  const socket = useSelector(state => state.webSocket)\r\n  const modal = useSelector(state => state.modal)\r\n  const {id} = useParams()\r\n  const [chat, setChat] = useState({})\r\n  const [newMessage, setNewMessage] = useState(null)\r\n  const [input, setInput] = useState(\"\")\r\n  const messageArea = useRef()\r\n  // alredyScroled нужна чтобы не пролистовать каждый раз чат\r\n  const alredyScroled = useRef(false)\r\n  const socketChat = useRef(new WebSocket(`ws://${global.serverLink.split(\"//\")[1]}/ws/chat`)) \r\n  useEffect(() => {\r\n    const getAll = async () =>{\r\n      const response = await ChatLogic.get(id)\r\n      if(response.message === \"success\"){\r\n        response.body.users.forEach((user, index) => {\r\n          if(user.id === auth.id){\r\n            response.body.users.splice(index, 1)\r\n          }\r\n        })\r\n        setChat(response.body)\r\n        WebSocketLogic.connect(auth, socketChat.current, modal, setNewMessage)\r\n      }else{\r\n        history.push(\"/\")\r\n      }\r\n    }\r\n    if(auth && socket && messageArea){\r\n      getAll()\r\n    }\r\n    return(\r\n      setChat([])\r\n    )\r\n  }, [auth, id, modal, history, socket])\r\n  useEffect(() => {\r\n    // логика сокета при получении нового сообщения изменяет переменую newMessage,\r\n    // запускаеться этот useEfect и передает сообщение в chat.messages \r\n    if(newMessage){\r\n      const newChat = {...chat}\r\n      newChat.messages.push(newMessage)\r\n      setChat(newChat)\r\n      setNewMessage(null)\r\n    }\r\n  }, [newMessage, chat])\r\n  useEffect(() => {\r\n    if(messageArea.current && !alredyScroled.current){\r\n      messageArea.current.scrollTop = messageArea.current.scrollHeight\r\n      alredyScroled.current = true\r\n    }\r\n  })\r\n  const send = () => {\r\n    const message ={\r\n      messageId: Date.now() + Math.random(),\r\n      senderId: auth.id,\r\n      body: input,\r\n      date: Date.now()\r\n    }\r\n    WebSocketLogic.sendAction(\"alert\", auth.id, chat.users[0].id, socket)\r\n    WebSocketLogic.sendAction(\"sentChatMessage\", auth.id, chat.users[0].id, socketChat.current, message)\r\n    ChatLogic.sendMessage(chat.id, message)\r\n    chat.messages.push(message)\r\n    setInput(\"\")\r\n  }\r\n  return(\r\n    <section className=\"chat\">\r\n      {\r\n        chat.id ?\r\n        <div className=\"container d-flex justify-content-center\">\r\n          <div className=\"card mt-5 d-flex flex-column\">\r\n              <div className=\"d-flex flex-row justify-content-between p-3 adiv text-white\">\r\n                <span className=\"pb-3\">Chat with {chat.users[0].username}</span> \r\n              </div>\r\n              <div ref={messageArea} className=\"messageArea flex-grow-1 overflow-auto\">\r\n              {chat.messages.map((message, index) => {\r\n                const color = (auth.id === message.senderId) ? \"green\" : \"white\" \r\n                const plase = (auth.id === message.senderId) ? \"l\" : \"r\" \r\n                return <div key={message.messageId} className={`d-flex justify-content-${plase === \"l\" ? \"start\" : \"end\"} flex-row p-3 message`}>\r\n                  {plase === \"l\" && <img src={avatar} alt=\"\" width=\"60\" height=\"60\" />}\r\n                <div className={`chat bg-${color} m${plase}-2 p-3`}>\r\n                  <span className=\"text\">{message.body}</span>\r\n                </div>{plase === \"r\" && <img src={avatar} alt=\"\" width=\"60\" height=\"60\" />}\r\n                </div>\r\n              })}\r\n              </div>\r\n              <div className=\"form-group px-3 d-flex align-items-center\">\r\n                <textarea value={input} onChange={(event) => setInput(event.target.value)} className=\"form-control\" rows=\"5\" placeholder=\"Type your message\"></textarea>\r\n                <button className=\"btn\" onClick={send}>Send</button>\r\n              </div>\r\n          </div>\r\n        </div>: <div className=\"main\">\r\n          <div className=\"spinner-grow text-primary\" role=\"status\">\r\n            <span className=\"visually-hidden\">Loading...</span>\r\n          </div>\r\n        </div>\r\n\r\n      }\r\n    </section>\r\n  )\r\n}","import \"../vars\"\r\nconst defaultState = new WebSocket(`ws://${global.serverLink.split(\"//\")[1]}/ws`)\r\n\r\nexport const webSocketReducer = (state = defaultState, action) => {\r\n  switch(action.type){\r\n    case \"SET_SOCKET\": return action.payload\r\n    default: return state\r\n  }\r\n}","import { fetchWrap } from \"./fetchWrap\"\r\n\r\nexport class AuthApi{\r\n  static async get(){\r\n    let response = await fetchWrap(\"auth/get\")\r\n    response = await response.json()\r\n    return response\r\n  }\r\n  static async loginOrRegister(data, type){\r\n    let response = await fetchWrap(`auth/${type}`, data)\r\n    response = await response.json()    \r\n    return response\r\n  }\r\n  static async logout(){\r\n    await fetchWrap(\"auth/logout\")\r\n    localStorage.removeItem(\"token\")\r\n  }\r\n}\r\n","import { AuthApi } from \"../api/auth\"\r\n\r\nexport class AuthLogic{\r\n  static async set(dispatch){\r\n    try{\r\n      const response = await AuthApi.get()\r\n      if(response.message === \"success\"){\r\n        dispatch({type: \"SET_AUTH\", payload: {id: response.id, username: response.username}})\r\n      }else{throw Error}\r\n    }catch(err){\r\n      localStorage.removeItem(\"token\")\r\n      dispatch({type: \"SET_AUTH\", payload: null})\r\n    }\r\n  }\r\n  static async loginOrRegister(data, type, dispatch){\r\n    try {\r\n      let response = await AuthApi.loginOrRegister(data, type)\r\n      if(response.message === \"success\"){\r\n      localStorage.setItem(\"token\", response.token)\r\n      dispatch({type: \"SET_AUTH\", payload: {id: data.id, username: data.username}})\r\n      return response.message\r\n      }else{\r\n        return response.message\r\n      }\r\n    }catch (err) {\r\n      return \"Something gone wrong\"\r\n    }\r\n  }\r\n}","import React from \"react\"\r\nimport { useDispatch, useSelector } from \"react-redux\"\r\nimport { useLocation, useHistory } from \"react-router\"\r\nimport { Link } from \"react-router-dom\"\r\nimport { AuthApi } from \"../../api/auth\"\r\n\r\n\r\nexport default function Header(){\r\n  const dispatch = useDispatch()\r\n  const location = useLocation().pathname\r\n  const history = useHistory()\r\n  const auth = useSelector(state => state.auth)\r\n  const logout = async () => {\r\n    await AuthApi.logout()\r\n    dispatch({type: \"SET_AUTH\", payload: null})\r\n    history.push(\"/\")\r\n  }\r\n  return(\r\n    <nav className=\"navbar navbar-expand-lg navbar-dark bg-primary\">\r\n      <div className=\"container-fluid\">\r\n        <Link className=\"navbar-brand\" to=\"/\">Chat</Link>\r\n        <button className=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n          <span className=\"navbar-toggler-icon\"></span>\r\n        </button>\r\n        <div className=\"collapse navbar-collapse\" id=\"navbarSupportedContent\">\r\n          <ul className=\"navbar-nav me-auto mb-2 mb-lg-0\">\r\n            <li className=\"nav-item\">\r\n              {\r\n                location === \"/\" ?\r\n                <span style={{cursor: \"pointer\"}} className=\"nav-link active\" aria-current=\"page\" to=\"/\">Home</span> :\r\n                <Link className=\"nav-link\" aria-current=\"page\" to=\"/\">Home</Link>\r\n              }\r\n            </li>\r\n            {\r\n              auth &&\r\n              <li className=\"nav-item\">\r\n              {\r\n                location === \"/mychats\" ?\r\n                <span style={{cursor: \"pointer\"}} className=\"nav-link active\">My Chats</span> :\r\n                <Link className=\"nav-link\" to=\"/mychats\">My Chats</Link>\r\n              }\r\n              </li>\r\n            }\r\n            <li className=\"nav-item\">\r\n              {\r\n                location === \"/allpeople\" ?\r\n                <span style={{cursor: \"pointer\"}} className=\"nav-link active\">All people</span> :\r\n                <Link className=\"nav-link\" to=\"/allpeople\">All people</Link>\r\n              }\r\n            </li>\r\n            {\r\n              auth &&\r\n              <li className=\"nav-item\">\r\n              {\r\n                location === \"/myfriends\" ?\r\n                <span style={{cursor: \"pointer\"}} className=\"nav-link active\" >My Friends</span> :\r\n                <Link className=\"nav-link\" to=\"/myfriends\">My Friends</Link>\r\n              }\r\n              </li>\r\n            }\r\n            {\r\n              auth &&\r\n              <li className=\"nav-item\">\r\n              {\r\n                location === \"/gotreq\" ?\r\n                <span style={{cursor: \"pointer\"}} className=\"nav-link active\" >Got Requests</span> :\r\n                <Link className=\"nav-link\" to=\"/gotreq\">Got Requests</Link>\r\n              }\r\n              </li>\r\n            }\r\n            {\r\n              !auth &&\r\n              <li className=\"nav-item\">\r\n                {\r\n                  location === \"/auth/login\" ?\r\n                  <span style={{cursor: \"pointer\"}} className=\"nav-link active\">Login</span> :\r\n                  <Link className=\"nav-link\" to=\"/auth/login\">Login</Link>\r\n                }\r\n              </li>\r\n            }\r\n            {\r\n              auth ?\r\n              <li className=\"nav-item\">\r\n                <span style={{cursor: \"pointer\"}} className=\"nav-link\" onClick={logout}>Logout</span>\r\n              </li> :\r\n              <li className=\"nav-item\">\r\n              {\r\n                location === \"/auth/register\" ?\r\n                <span style={{cursor: \"pointer\"}} className=\"nav-link active\">Register</span> :\r\n                <Link className=\"nav-link\" to=\"/auth/register\">Register</Link>\r\n              }\r\n            </li>\r\n            }\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </nav>\r\n  )\r\n}\r\n\r\n","import React from \"react\"\r\nimport { useSelector } from \"react-redux\"\r\n\r\nimport \"./Main.sass\"\r\n\r\nexport default function Main(){\r\n  const auth = useSelector(state => state.auth)\r\n  let username = \"Guest\"\r\n  if(auth){\r\n    username = auth.username\r\n  } \r\n  return(\r\n    <section className=\"main\">\r\n      <h1>Hello {username}, this is site where you can text with others</h1>\r\n    </section>\r\n  )\r\n}","import { fetchWrap } from \"./fetchWrap\"\r\n\r\nexport class  UserApi{\r\n  static async getAll(){\r\n    let response = await fetchWrap(\"users/getAll\")\r\n    response = await response.json()\r\n    return response\r\n  }\r\n  static async getProperty(property){\r\n    let response = await fetchWrap(\"users/getProperty\", {property})\r\n    response = await response.json()\r\n    return response\r\n  }\r\n  static async sendAction(recipientId, action){\r\n    let response = await fetchWrap(\"users/sendAction\", {recipientId, action})\r\n    response = await response.json()\r\n    return response\r\n  }\r\n}","import { UserApi } from \"../api/user\";\r\n\r\nexport class UserLogic{\r\n  static async getAll(){\r\n    try{\r\n      const response = await UserApi.getAll()\r\n      if(response.message === \"success\"){\r\n        return response.body\r\n      }else{\r\n        throw Error\r\n      }\r\n    }catch(err){\r\n      return []\r\n    }\r\n  }\r\n  static async getProperty(property){\r\n    try{\r\n      const response = await UserApi.getProperty(property)\r\n      if(response.message === \"success\"){\r\n        return response.body\r\n      }else{\r\n        throw Error\r\n      }\r\n    }catch(err){\r\n      return []\r\n    }\r\n  }\r\n  static async sendAction(recipientId, action){\r\n    try{\r\n      const response = await UserApi.sendAction(recipientId, action)\r\n      return response\r\n    }catch(err){\r\n\r\n    }\r\n  }\r\n}","import React, {useState, useEffect, useMemo} from \"react\"\r\nimport { useSelector, useDispatch } from \"react-redux\"\r\nimport { useHistory } from \"react-router-dom\"\r\n\r\nimport { UserLogic } from \"../../logic/user\"\r\nimport { ChatLogic } from \"../../logic/chat\"\r\nimport { WebSocketLogic } from \"../../logic/webSocket\"\r\nimport avatar from \"../../assets/img/avatar.png\"\r\nimport \"./Userlist.sass\"\r\n\r\nexport default function UsersList({type, label}){\r\n  const history = useHistory()\r\n  const dispatch = useDispatch()\r\n  const auth = useSelector(state => state.auth)\r\n  const socket = useSelector(state => state.webSocket)\r\n  const modal = useSelector(state => state.modal)\r\n  // Обяснения в modal.jsx\r\n  const [render, setRender] = useState(new Date())\r\n  const [page, setPage] = useState(1)\r\n  const [people, setPeople] = useState([])\r\n  const [searchInput, setSearchInput] = useState(\"\")\r\n  const [allpage, setAllPage] = useState(1)\r\n  const sortedPeople = useMemo(() => {\r\n    if(people.length){\r\n      return people.filter(person => person.username.toLowerCase().includes(searchInput.toLowerCase()))\r\n    }\r\n  }, [people, searchInput])\r\n  useEffect(() => {\r\n    if(!auth){\r\n      const forbiddenTypesForAnauth = [\"chats\", \"friends\", \"got\"]\r\n      if(forbiddenTypesForAnauth.includes(type)){\r\n        history.push(\"/\")\r\n      }\r\n    }\r\n    dispatch({type: \"SET_RENDERLIST\", payload: setRender})\r\n    const getAll = async () =>{\r\n      if(type === \"all\"){\r\n        setPeople(await UserLogic.getAll())\r\n      }else{\r\n        setPeople(await UserLogic.getProperty(type))\r\n      }\r\n    }\r\n    getAll()\r\n    return(\r\n      setPeople([])\r\n    )\r\n  }, [type, auth, history, render, dispatch])\r\n  useEffect(() => {\r\n    if(sortedPeople){\r\n      setPage(1)\r\n      setAllPage(Math.ceil(sortedPeople.length / 10))\r\n    }\r\n    return(\r\n      setAllPage(1)\r\n    )\r\n  }, [sortedPeople])\r\n  const action = async (id, action) =>{\r\n    if(auth){\r\n      await UserLogic.sendAction(id, action)\r\n      WebSocketLogic.sendAction(action, auth.id, id, socket)\r\n      if(type === \"all\"){\r\n        setPeople(await UserLogic.getAll())\r\n      }else{\r\n        setPeople(await UserLogic.getProperty(type))\r\n      }\r\n    }else{\r\n      modal(\"You nead Login or Register first\")\r\n    }\r\n  }\r\n  const chatAction = async (id, chat) =>{\r\n    if(auth){\r\n      if(chat){\r\n        history.push(`/chat/${chat}`)\r\n      }else{\r\n        const response = await ChatLogic.create(id)\r\n        if(response.message === \"success\"){\r\n          history.push(`/chat/${response.body.id}`)\r\n        }\r\n    } \r\n    }else{\r\n      modal(\"You nead Login or Register first\")\r\n    }\r\n  }\r\n\r\n  return(\r\n    <section className=\"list\">\r\n      <div className=\"logoAndSearch d-flex justify-content-between mb-5\">\r\n        <h1>{type === \"all\" ? \"All\" : \"My\" } {label}</h1>\r\n        <form className=\"search d-flex\">\r\n            <input className=\"form-control me-2\" value={searchInput} onChange={event => setSearchInput(event.target.value)} type=\"search\" placeholder=\"Search people\" aria-label=\"Search\" />\r\n            <button className=\"btn btn-outline-light\" type=\"submit\">Search</button>\r\n        </form>\r\n        </div>\r\n      {\r\n        people.length ? \r\n        <div className=\"row main\">\r\n          { sortedPeople.length ? \r\n            sortedPeople.map((person, index) => { \r\n              let color = \"primary\"\r\n              let inner = \"Add to friends\"\r\n              let typeAction = \"modal\"\r\n              let chatId = false\r\n              if(auth){\r\n                if(person.username === auth.username){return false}\r\n                color = person.friends.includes(auth.id) ? \"danger\" :\r\n                  person.gotReq.includes(auth.id) ? \"danger\" :\r\n                  person.sentReq.includes(auth.id) ? \"success\": \r\n                  \"primary\"\r\n\r\n                inner = person.friends.includes(auth.id) ? \"Delete from friends\" :\r\n                  person.gotReq.includes(auth.id) ? \"Cancel request\" :\r\n                  person.sentReq.includes(auth.id) ? \"Accept request\" :\r\n                  \"Add to friends\"\r\n\r\n                typeAction = person.friends.includes(auth.id) ? \"deleteFriend\" :\r\n                  person.gotReq.includes(auth.id) ? \"cancelReq\" :\r\n                  person.sentReq.includes(auth.id) ? \"acceptReq\" :\r\n                  \"sendReq\"\r\n                person.chats.forEach(chat => {\r\n                  if(chat.users.includes(auth.id)){\r\n                    chatId = chat.chatId\r\n                  }\r\n                })\r\n              }\r\n                if(page === 1 && index < 10){\r\n                  return  <div className=\"col-sm-6\" key={person.id}>\r\n                    <div className=\"card\">\r\n                      <div className=\"card-body\">\r\n                        <h5 className=\"card-title\"><img style={{width: \"50px\"}} src={avatar} alt=\"\"  /> {person.username}</h5>\r\n                        <p className=\"card-text\">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Distinctio blanditiis debitis, itaque atque excepturi commodi quaera.</p>\r\n                        <button onClick={() => chatAction(person.id, chatId)}  className=\"btn btn-primary\">Chat</button>\r\n                        <button onClick={() => action(person.id, typeAction)} className={\"btn btn-\" + color}>{inner}</button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                }if(index >= (page - 1) * 10 && index < page * 10){\r\n                  return  <div className=\"col-sm-6\" key={person.id}>\r\n                    <div className=\"card\">\r\n                      <div className=\"card-body\">\r\n                        <h5 className=\"card-title\"><img style={{width: \"50px\"}} src={avatar} alt=\"\"  /> {person.username}</h5>\r\n                        <p className=\"card-text\">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Distinctio blanditiis debitis, itaque atque excepturi commodi quaera.</p>\r\n                        <button onClick={() => chatAction(person.id, chatId)} className=\"btn btn-primary\">Chat</button>\r\n                        <button onClick={() => action(person.id, typeAction)} className={\"btn btn-\" + color}>{inner}</button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                }\r\n                return null \r\n                }) :\r\n            <h2 className=\"main\" >such people do not exist</h2>\r\n          }\r\n        </div>: <div className=\"result\">\r\n          You dont have any {label}\r\n        </div>\r\n      }\r\n      {\r\n        sortedPeople &&\r\n        <div className=\"pages\">\r\n        {\r\n          page > 1 && <span className=\"change\" onClick={() => {if(page > 1){setPage(page - 1)}}} >prev/</span>\r\n        }\r\n        <span>{page}</span>\r\n        {\r\n          page < allpage && <span className=\"change\" onClick={() => setPage(page + 1)} >/next</span>\r\n        }\r\n        </div>\r\n      }\r\n    </section>\r\n  )\r\n}","import React, { useRef } from \"react\"\r\nimport { useDispatch, useSelector } from \"react-redux\"\r\nimport { useParams } from \"react-router\"\r\nimport { Link, useHistory } from \"react-router-dom\"\r\n\r\nimport { AuthLogic } from \"../../logic/auth\"\r\n\r\nexport default function Auth(){\r\n  const history = useHistory()\r\n  const auth = useSelector(state => state.auth)\r\n  if(auth){\r\n    history.push(\"/\")\r\n  }\r\n  const type = useParams().type\r\n  const dispatch = useDispatch()\r\n  const errHandler = useRef()\r\n  const submit = async (event) => {\r\n    event.preventDefault()\r\n    let data = new FormData(event.target)\r\n    data = Object.fromEntries(data)    \r\n    let response = await AuthLogic.loginOrRegister(data, type, dispatch)\r\n    if(response === \"success\"){\r\n      document.location.href = \"/\"\r\n    }else{\r\n      errHandler.current.textContent = response\r\n      errHandler.current.style.color = \"red\"\r\n      setTimeout( () =>{\r\n        errHandler.current.textContent = \"Username\"\r\n        errHandler.current.style.color = \"black\"\r\n      }, 3000)\r\n    }\r\n  }\r\n  return(\r\n    type === \"login\" ? \r\n      <section className=\"auth container py-5\">\r\n        <div className=\"row d-flex justify-content-center align-items-center\">\r\n          <div className=\"col-12 col-md-8 col-lg-6 col-xl-5\">\r\n            <div className=\"card shadow-2-strong\" style={{borderRadius: \"1rem\"}}>\r\n              <form className=\"card-body p-5 text-center\" onSubmit={submit}>\r\n                <h3 className=\"mb-5\">Login</h3>\r\n                <div className=\"form-outline mb-4\">\r\n                  <input required name=\"username\" id=\"username\" className=\"form-control form-control-lg\" />\r\n                  <label ref={errHandler} style={{transition: \"all 1.5s\"}} className=\"form-label\" htmlFor=\"username\">Username</label>\r\n                </div>\r\n                <div className=\"form-outline mb-4\">\r\n                  <input required type=\"password\" name=\"password\" id=\"password\" className=\"form-control form-control-lg\" />\r\n                  <label className=\"form-label\" htmlFor=\"password\">Password</label>\r\n                </div>\r\n                <div className=\"d-flex justify-content-between mb-4\">\r\n                  <Link to=\"/\"> Reset password </Link>\r\n                  <Link to=\"/auth/register\"> Register </Link>\r\n                </div>\r\n                <button className=\"btn btn-primary btn-lg btn-block\" type=\"submit\">Login</button>\r\n                <hr className=\"my-4\" />\r\n              </form>\r\n            </div>\r\n          </div>\r\n        </div>        \r\n      </section> :\r\n        <section className=\"auth container py-5\">\r\n          <div className=\"row d-flex justify-content-center align-items-center\">\r\n            <div className=\"col-12 col-md-8 col-lg-6 col-xl-5\">\r\n              <div className=\"card shadow-2-strong\" style={{borderRadius: \"1rem\"}}>\r\n                <form className=\"card-body p-5 text-center\" onSubmit={submit}>\r\n                  <h3 className=\"mb-5\">Register</h3>\r\n                  <div className=\"form-outline mb-4\">\r\n                    <input required type=\"username\" name=\"username\" id=\"username\" className=\"form-control form-control-lg\" />\r\n                    <label ref={errHandler} style={{transition: \"all 1.5s\"}} className=\"form-label\" htmlFor=\"username\">Username</label>\r\n                  </div>\r\n                  <div className=\"form-outline mb-4\">\r\n                    <input required type=\"password\" name=\"password\" id=\"password\" className=\"form-control form-control-lg\" />\r\n                    <label type=\"password\" className=\"form-label\" htmlFor=\"password\">Password</label>\r\n                  </div>\r\n                  <div className=\"form-outline mb-4\">\r\n                    <input required type=\"emali\" name=\"email\" id=\"email\" className=\"form-control form-control-lg\" />\r\n                    <label type=\"email\" className=\"form-label\" htmlFor=\"email\">Email</label>\r\n                  </div>\r\n                  <div className=\"d-flex justify-content-between mb-4\">\r\n                    <Link to=\"/\"> Reset password </Link>\r\n                    <Link to=\"/auth/login\"> Login </Link>\r\n                  </div>\r\n                  <button className=\"btn btn-primary btn-lg btn-block\" type=\"submit\">Register</button>\r\n                  <hr className=\"my-4\" />\r\n                </form>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </section>\r\n  )\r\n}","export default __webpack_public_path__ + \"static/media/new_message.9412f5cf.wav\";","import React, { useState } from \"react\"\r\n\r\nimport sound from \"../../assets/audio/new_message.wav\"\r\nimport { useDispatch, useSelector } from \"react-redux\"\r\nimport \"./Modal.sass\"\r\n\r\nexport default function Modal(){\r\n  const [modalBody, setModalBody] = useState(\"\")\r\n  const stateModalBody = useSelector(state => state.modal)\r\n  const stateRenderList = useSelector(state => state.renderList)\r\n  const notification = new Audio(sound)\r\n  const dispatch = useDispatch()\r\n  if(!stateModalBody){\r\n    dispatch({type: \"SET_MODAL\", payload: setModalBody}) \r\n    // Проверка есть ли в store тело модалки,\r\n    // если есть значит не нужно перезначать(чтобы не не было бесконечного цикла) \r\n  }\r\n  if(modalBody){\r\n    notification.play()\r\n    //Нужен для рендера списка юзеров чтобы когда пришло уведомление от webSocket\r\n    setTimeout(() => {\r\n      stateRenderList(new Date())\r\n    }, 300)\r\n    setTimeout(() => {\r\n      setModalBody(\"\")\r\n    }, 3000)\r\n  }\r\n  return(\r\n    modalBody &&\r\n    <div className=\"message\">\r\n      <div className=\"modal-dialog\">\r\n        <div className=\"modal-content\">\r\n          <div className=\"modal-header\">\r\n            <h5 className=\"modal-title\" id=\"staticBackdropLabel\">New message</h5>\r\n            <button onClick={() => setModalBody(\"\")} type=\"button\" className=\"btn-close\"></button>\r\n          </div>\r\n          <div className=\"modal-body\">\r\n            {modalBody}\r\n          </div>\r\n          <div className=\"modal-footer\">\r\n            <button onClick={() => setModalBody(\"\")} type=\"button\" className=\"btn btn-secondary\">Close</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}","import React, { useEffect } from \"react\"\r\nimport { BrowserRouter, Switch, Route, Redirect } from \"react-router-dom\"\r\nimport { useSelector, useDispatch } from \"react-redux\"\r\n\r\nimport { AuthLogic } from \"../logic/auth\"\r\nimport { WebSocketLogic } from \"../logic/webSocket\"\r\n\r\nimport Header from \"./Header/Header\"\r\nimport Main from \"./Main/Main\"\r\nimport UsersList from \"./UsersList/UsersList\"\r\nimport Auth from \"./Auth/Auth\"\r\nimport Chat from \"./Chat/Chat\"\r\nimport Modal from \"./Modal/Modal\"\r\n\r\nexport default function App(){\r\n  const dispatch = useDispatch()\r\n  const socket = useSelector(state => state.webSocket)\r\n  const auth = useSelector(state => state.auth)\r\n  const modal = useSelector(state => state.modal)\r\n  useEffect(() => {\r\n    const start = async () => {\r\n      await AuthLogic.set(dispatch)\r\n    }\r\n    if(localStorage.getItem(\"token\")){\r\n      start()\r\n    }\r\n  }, [dispatch])\r\n  useEffect(() => {\r\n    // нужно доделать взаимодействие с модалкой\r\n    if(auth && socket && modal){\r\n      WebSocketLogic.connect(auth, socket, modal)\r\n    }\r\n  }, [auth, socket, modal])\r\n  return(\r\n    <div className=\"app\" style={{minHeight: \"100vh\"}}>\r\n      <BrowserRouter>\r\n        <Header/>\r\n        <Modal />\r\n        <Switch> \r\n          <Route exact path=\"/\" component={Main} />\r\n          <Route path=\"/auth/:type\" component={Auth} />\r\n          <Route exact path=\"/mychats\" component={() => <UsersList type=\"chats\" label=\"Chats\" />} />\r\n          <Route exact path=\"/allpeople\" component={() => <UsersList type=\"all\" label=\"People\" />} />\r\n          <Route exact path=\"/myfriends\" component={() => <UsersList type=\"friends\" label=\"Friends\" />} />\r\n          <Route exact path=\"/gotReq\" component={() => <UsersList type=\"gotReq\" label=\"Got friends request\" />} />\r\n          <Route path={\"/chat/:id\"} component={Chat} />\r\n          <Redirect to=\"/\" />\r\n        </Switch>\r\n      </BrowserRouter>\r\n    </div>\r\n  )\r\n}","import { combineReducers, createStore } from \"redux\";\r\nimport { authReducer } from \"./auth\";\r\nimport { webSocketReducer } from \"./webSocket\";\r\nimport { modalReducer } from \"./modal\"\r\nimport { RenderListReducer } from \"./RenderList\";\r\n\r\nconst rootReducer = combineReducers({\r\n  auth: authReducer,\r\n  webSocket: webSocketReducer,\r\n  modal: modalReducer,\r\n  renderList: RenderListReducer,\r\n})\r\n\r\nexport const store = createStore(rootReducer)","const defaultState = null\r\n\r\nexport const authReducer = (state = defaultState, action) => {\r\n  switch(action.type){\r\n    case \"SET_AUTH\": if(action.payload){return {...action.payload}}else{return action.payload}\r\n    default: return state\r\n  }\r\n}","const defaultState = \"\"\r\n\r\nexport const modalReducer = (state = defaultState, action) => {\r\n  switch(action.type){\r\n    case \"SET_MODAL\": return action.payload\r\n    default: return state\r\n  }\r\n} ","const defaultState = null\r\n\r\nexport const RenderListReducer = (state = defaultState, action) =>{\r\n  switch(action.type){\r\n    case \"SET_RENDERLIST\": return action.payload\r\n    default: return state \r\n  }\r\n}","import React from \"react\"\r\nimport ReactDOM from \"react-dom\"\r\nimport App from \"./components/App\"\r\nimport { Provider } from \"react-redux\"\r\nimport { store } from \"./store\"\r\n\r\nimport \"./vars\"\r\nimport \"./index.sass\"\r\n\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <App />\r\n  </Provider>,\r\n  document.querySelector(\"#root\")\r\n)\r\n"],"sourceRoot":""}